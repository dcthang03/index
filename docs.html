<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hand Counter Tournament Docs</title>
  <style>
    :root {
      --bg: #f5f7fb;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #475569;
      --line: #dbe2f0;
      --primary: #0b5ed7;
      --max: 1080px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, sans-serif;
      color: var(--text);
      background: linear-gradient(180deg, #eef3ff 0%, var(--bg) 240px, var(--bg) 100%);
      line-height: 1.6;
    }
    .wrap {
      max-width: var(--max);
      margin: 0 auto;
      padding: 24px 16px 40px;
    }
    .hero {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 16px;
    }
    h1, h2, h3 { margin: 0 0 10px; line-height: 1.3; }
    h1 { font-size: 30px; }
    h2 {
      font-size: 22px;
      border-bottom: 1px solid var(--line);
      padding-bottom: 8px;
      margin-top: 24px;
    }
    p { margin: 0 0 10px; }
    .muted { color: var(--muted); }
    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 22px;
      margin-bottom: 14px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
      font-size: 14px;
    }
    th, td {
      border: 1px solid var(--line);
      padding: 8px 10px;
      text-align: left;
      vertical-align: top;
    }
    th { background: #f8faff; }
    code, pre {
      font-family: Consolas, Monaco, "Courier New", monospace;
      font-size: 13px;
    }
    pre {
      background: #0b1220;
      color: #e2ecff;
      border-radius: 10px;
      padding: 12px;
      overflow-x: auto;
      margin: 10px 0;
    }
    ul { margin: 8px 0 0 20px; }
    .ok { color: #0f766e; font-weight: 700; }
    .footer {
      text-align: center;
      color: var(--muted);
      font-size: 13px;
      margin-top: 10px;
    }
    .badge {
      display: inline-block;
      background: #e8f0ff;
      color: var(--primary);
      border: 1px solid #c8d9ff;
      border-radius: 999px;
      padding: 5px 10px;
      font-size: 12px;
      font-weight: 700;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="hero">
      <div class="badge">Hand Counter Tournament</div>
      <h1>Hand Counter Tournament Documentation</h1>
      <p>Hand Counter Tournament là hệ thống vận hành giải poker theo mô hình <strong>semi-automated tournament control</strong>, giúp club quản lý hand progression, seating, và chip tracking theo thời gian thực mà không cần chip RFID hoặc camera tracking.</p>
    </section>

    <section class="card">
      <h2>Mục tiêu sản phẩm</h2>
      <ul>
        <li>Chuẩn hoá vận hành tournament theo hướng digital-first workflow.</li>
        <li>Giảm sai sót thủ công khi ghi chép hand / move / chip status.</li>
        <li>Cung cấp leaderboard realtime theo từng hand để Floor &amp; Owner kiểm soát tình trạng giải.</li>
        <li>Tối ưu thao tác Dealer: mỗi hành động chỉ ~0.5 giây/tap.</li>
        <li>Không thay đổi flow deal truyền thống, Dealer học nhanh, không gây "tech shock".</li>
      </ul>
    </section>

    <section class="card">
      <h2>Vai trò người dùng</h2>
      <table>
        <thead>
          <tr>
            <th>Role</th>
            <th>Quyền chính</th>
            <th>Mục tiêu sử dụng</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Dealer</td>
            <td>Gán seat, Next Hand, update trạng thái</td>
            <td>Vận hành bàn nhanh, ít thao tác</td>
          </tr>
          <tr>
            <td>Floor</td>
            <td>Move / Reject / Correct</td>
            <td>Kiểm soát logic tournament</td>
          </tr>
          <tr>
            <td>Owner</td>
            <td>Theo dõi toàn giải, audit</td>
            <td>Giám sát &amp; báo cáo</td>
          </tr>
        </tbody>
      </table>

      <h3>Thời gian đào tạo</h3>
      <p>Club chỉ cần <strong>30 phút training Dealer</strong> là có thể vận hành.</p>
    </section>

    <section class="card">
      <h2>Luồng vận hành tổng quan</h2>
      <ol>
        <li>Player check-in bằng <code>player_uid</code> hoặc QR Member.</li>
        <li>Dealer scan rồi assign vào seat.</li>
        <li>Dealer tap Next Hand sau mỗi hand.</li>
        <li>System snapshot leaderboard realtime.</li>
        <li>Floor can intervene nếu cần move / reject / adjust.</li>
      </ol>
    </section>

    <section class="card">
      <h2>Quick Start</h2>
      <h3>Yêu cầu hệ thống</h3>
      <ul>
        <li>Tablet hoặc iPad tại mỗi table (khuyến nghị ≥10").</li>
        <li>WiFi nội bộ ổn định (LAN preferred).</li>
        <li>1 màn hình TV / Dashboard để hiển thị leaderboard.</li>
      </ul>

      <h3>Checklist triển khai nhanh</h3>
      <ul>
        <li><span class="ok">✔</span> Tạo Tournament trong Admin</li>
        <li><span class="ok">✔</span> Import danh sách Player (hoặc dùng DB có sẵn của club)</li>
        <li><span class="ok">✔</span> In QR Member (optional nhưng khuyến nghị)</li>
        <li><span class="ok">✔</span> Gán thiết bị cho từng Table</li>
        <li><span class="ok">✔</span> Test Next Hand sync</li>
        <li><span class="ok">✔</span> Verify Leaderboard realtime</li>
        <li><span class="ok">✔</span> Go-Live</li>
      </ul>

      <h3>Before Go-Live Test (5 phút)</h3>
      <ul>
        <li>Test scan QR và assign seat.</li>
        <li>Test Move player.</li>
        <li>Test leaderboard update &lt; 1s.</li>
        <li>Test reconnect network.</li>
      </ul>
    </section>

    <section class="card">
      <h2>Data Model</h2>
      <h3>Core Entities</h3>

      <h3><code>tournament</code></h3>
      <table>
        <thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead>
        <tbody>
          <tr><td>tournament_id</td><td>text</td><td>ID giải đấu</td></tr>
          <tr><td>name</td><td>text</td><td>Tên giải</td></tr>
          <tr><td>starting_chips</td><td>int</td><td>Stack khởi điểm</td></tr>
          <tr><td>status</td><td>enum</td><td>pending / running / closed</td></tr>
        </tbody>
      </table>

      <h3><code>table</code></h3>
      <table>
        <thead><tr><th>Field</th><th>Type</th></tr></thead>
        <tbody>
          <tr><td>table_id</td><td>text</td></tr>
          <tr><td>tournament_id</td><td>fk</td></tr>
          <tr><td>max_seats</td><td>int</td></tr>
        </tbody>
      </table>

      <h3><code>seat</code></h3>
      <table>
        <thead><tr><th>Field</th><th>Type</th></tr></thead>
        <tbody>
          <tr><td>seat_id</td><td>text</td></tr>
          <tr><td>table_id</td><td>fk</td></tr>
          <tr><td>player_uid</td><td>nullable</td></tr>
          <tr><td>is_active</td><td>bool</td></tr>
        </tbody>
      </table>

      <h3><code>player</code></h3>
      <table>
        <thead><tr><th>Field</th><th>Type</th></tr></thead>
        <tbody>
          <tr><td>player_uid</td><td>text (club-defined)</td></tr>
          <tr><td>player_name</td><td>text</td></tr>
          <tr><td>member_qr</td><td>optional</td></tr>
        </tbody>
      </table>

      <p class="muted">Có thể dùng luôn <code>player_uid</code> hiện tại của club, không cần migrate hệ thống cũ.</p>

      <h3><code>event_log</code></h3>
      <p>Immutable audit trail.</p>
      <table>
        <thead><tr><th>Field</th><th>Type</th></tr></thead>
        <tbody>
          <tr><td>event_id</td><td>uuid</td></tr>
          <tr><td>type</td><td>next_hand / move / assign</td></tr>
          <tr><td>actor_role</td><td>dealer/floor</td></tr>
          <tr><td>timestamp</td><td>timestamptz</td></tr>
        </tbody>
      </table>

      <h3><code>leaderboard_snapshot</code></h3>
      <p>Generated mỗi lần Next Hand.</p>
      <table>
        <thead><tr><th>Field</th><th>Type</th></tr></thead>
        <tbody>
          <tr><td>player_uid</td><td>fk</td></tr>
          <tr><td>tournament_id</td><td>fk</td></tr>
          <tr><td>player_chips</td><td>int</td></tr>
          <tr><td>hand_no</td><td>int</td></tr>
        </tbody>
      </table>

      <p class="muted">Đây là snapshot-based model để đảm bảo audit và rollback.</p>
    </section>

    <section class="card">
      <h2>API / Events</h2>

      <h3>Next Hand Event</h3>
      <p>Trigger chính của hệ thống.</p>
      <p><code>POST /event/next-hand</code></p>
      <p>Payload:</p>
      <pre>{
  "table_id": "T12",
  "dealer_id": "D03",
  "hand_no": 128
}</pre>

      <p>System sẽ:</p>
      <ul>
        <li>Lock state bàn</li>
        <li>Commit snapshot leaderboard</li>
        <li>Broadcast realtime update</li>
        <li>Unlock</li>
      </ul>
      <p>Latency mục tiêu: <strong>&lt;300ms</strong></p>

      <h3>Assign Player (QR Scan)</h3>
      <p><code>POST /seat/assign</code></p>
      <pre>{
  "seat_id": "T12-S4",
  "player_uid": "A104"
}</pre>

      <h3>Move Player (Floor Action)</h3>
      <p><code>POST /floor/move</code></p>
      <p>Atomic swap để tránh duplicate seat.</p>

      <h3>Error Codes</h3>
      <table>
        <thead><tr><th>Code</th><th>Meaning</th></tr></thead>
        <tbody>
          <tr><td>409</td><td>Seat already occupied</td></tr>
          <tr><td>422</td><td>Player not registered</td></tr>
          <tr><td>503</td><td>Sync delay</td></tr>
        </tbody>
      </table>

      <h3>Retry Strategy</h3>
      <p>Dealer UI auto-retry silently (idempotent).</p>
    </section>

    <section class="card">
      <h2>Security</h2>
      <h3>Role-Based Access Control</h3>
      <table>
        <thead>
          <tr>
            <th>Action</th>
            <th>Dealer</th>
            <th>Floor</th>
            <th>Owner</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Next Hand</td><td>✔</td><td>✔</td><td>✔</td></tr>
          <tr><td>Assign Seat</td><td>✔</td><td>✔</td><td>✔</td></tr>
          <tr><td>Move Player</td><td>✖</td><td>✔</td><td>✔</td></tr>
          <tr><td>Reject Action</td><td>✖</td><td>✔</td><td>✔</td></tr>
          <tr><td>Audit Logs</td><td>✖</td><td>✖</td><td>✔</td></tr>
        </tbody>
      </table>

      <h3>Audit Design</h3>
      <ul>
        <li>Không cho phép edit trực tiếp chip.</li>
        <li>Chỉ append event.</li>
        <li>Mọi thay đổi có trace.</li>
      </ul>
      <p>System theo triết lý: <strong>Operational Transparency over Automation</strong>.</p>
    </section>

    <section class="card">
      <h2>Operational Characteristics</h2>
      <h3>Semi-Automated Philosophy</h3>
      <p>Không cố "auto hóa toàn bộ" như RFID system. Thay vào đó:</p>
      <ul>
        <li>Human-driven</li>
        <li>System-validated</li>
        <li>Instant recorded</li>
      </ul>
      <p>Phù hợp môi trường club thực tế.</p>

      <h3>Performance Target</h3>
      <table>
        <thead><tr><th>Metric</th><th>Target</th></tr></thead>
        <tbody>
          <tr><td>Dealer action time</td><td>~0.5s</td></tr>
          <tr><td>Leaderboard refresh</td><td>realtime</td></tr>
          <tr><td>Training time</td><td>30 phút</td></tr>
          <tr><td>Failure tolerance</td><td>Offline buffer</td></tr>
        </tbody>
      </table>
    </section>

    <section class="card">
      <h2>Troubleshooting</h2>
      <h3>Leaderboard không update</h3>
      <ul>
        <li>Check Next Hand đã tap chưa.</li>
        <li>Check network latency.</li>
        <li>Re-sync snapshot.</li>
      </ul>

      <h3>Dealer nhập sai seat</h3>
      <p>Floor dùng Move (non-destructive correction).</p>

      <h3>Mất kết nối</h3>
      <p>Local queue sẽ sync lại khi online.</p>
    </section>

    <section class="card">
      <h2>Changelog </h2>
      <pre>Version: 1.0.0
Date: 2026
Author: Team Rivebase
Summary:
- Initial tournament workflow
- Realtime leaderboard snapshot model</pre>
    </section>

    <section class="card">
      <h2>Deployment Scope</h2>
      <p>Hệ thống phù hợp cho:</p>
      <ul>
        <li>Club muốn digital hoá nhanh nhưng không đầu tư RFID.</li>
        <li>Tournament 20-300 players.</li>
        <li>Môi trường cần kiểm soát minh bạch nhưng vận hành linh hoạt.</li>
      </ul>
    </section>

    <div class="footer">Rivebase Docs - Hand Counter Tournament</div>
  </main>
</body>
</html>
